(function(e){function t(t){for(var a,i,o=t[0],c=t[1],l=t[2],d=0,f=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&f.push(r[i][0]),r[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(f.length)f.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],a=!0,o=1;o<n.length;o++){var c=n[o];0!==r[c]&&(a=!1)}a&&(s.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},r={app:0},s=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/slack-vue/dist/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"00ac":function(e,t,n){},1:function(e,t){},10:function(e,t){},11:function(e,t){},"11f4":function(e,t,n){"use strict";n("f127")},12:function(e,t){},13:function(e,t){},14:function(e,t){},2:function(e,t){},2154:function(e,t,n){},"21a6":function(e,t,n){"use strict";n("7b9f")},2646:function(e,t,n){},3:function(e,t){},4:function(e,t){},5:function(e,t){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},s=[],i={name:"app"},o=i,c=n("2877"),l=Object(c["a"])(o,r,s,!1,null,null,null),u=l.exports,d=n("8c4f"),f=(n("7db0"),n("b0c0"),n("99af"),n("2f62")),m=n("1da1"),h=(n("96cf"),n("260b"));n("ea7b"),n("66ce"),n("588e");h["a"].initializeApp({apiKey:"AIzaSyCm5kn-3Cx3zCFbon3FpXpGTieOOvlSMko",authDomain:"slack-vue-1a6f6.firebaseapp.com",projectId:"slack-vue-1a6f6",storageBucket:"slack-vue-1a6f6.appspot.com",messagingSenderId:"1066323579198",appId:"1:1066323579198:web:61a87ec407328a7dcc1c6f",measurementId:"G-5TZG2RZF6H"}),a["default"].prototype.$firebase=h["a"];var p=h["a"],g={login:function(){return Object(m["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=new p.auth.GoogleAuthProvider,t.addScope("profile"),t.addScope("email"),e.next=5,p.auth().signInWithPopup(t).then((function(e){var t=e.additionalUserInfo.profile,n=t.email,a=t.given_name,r=t.picture,s=e.user.uid;return{status:!0,accessToken:e.credential.accessToken,profile:{name:a,email:n,picture:r,uid:s}}})).catch((function(e){return{status:!1,message:e.message}}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))()},logout:function(){return Object(m["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p.auth().signOut();case 2:case"end":return e.stop()}}),e)})))()}},v={saveUser:function(e){return Object(m["a"])(regeneratorRuntime.mark((function t(){var n,a,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=p.database().ref("users"),a=e.uid,r=e.name,s=e.picture,t.next=4,n.child(a).set({name:r,avatar:s});case 4:case"end":return t.stop()}}),t)})))()},addChannel:function(e){return Object(m["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=p.database().ref("channels"),a=n.push().key,t.next=4,n.child(a).set({id:a,name:e}).then((function(){return{status:!0,message:""}})).catch((function(e){return{status:!1,message:e.message}}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))()},addMessage:function(e){return Object(m["a"])(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.channelId,a=e.msgInfo,r=p.database().ref("messages"),t.next=4,r.child(n).push().set(a);case 4:case"end":return t.stop()}}),t)})))()},addPrivateMsg:function(e){return Object(m["a"])(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.channelId,a=e.msgInfo,r=p.database().ref("privateMsg"),t.next=4,r.child(n).push().set(a);case 4:case"end":return t.stop()}}),t)})))()},removePresence:function(e){return Object(m["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=p.database().ref("presence"),t.next=3,n.child(e).remove();case 3:case"end":return t.stop()}}),t)})))()}},b=g,C=v,_=(n("d3b7"),n("25f0"),n("3452")),w=n.n(_),y=w.a.enc.Utf8,x=w.a.enc.Base64,k=w.a.MD5,I=w.a.AES,S={encodeMd5:function(e){return k(e).toString()},encodeUtf8:function(e){return y.parse(e)},decodeUft8:function(e){return y.stringify(e)},encodeBase64:function(e){var t=this.encodeUtf8(e);return x.stringify(t)},decodeBase64:function(e){var t=x.parse(e);return this.decodeUft8(t)},encodeAes:function(e){return I.encrypt(e,"secret123").toString()},decodeAes:function(e){var t=I.decrypt(e,"secret123");return t.toString(y)},encodeAesJson:function(e){return this.encodeAes(JSON.stringify(e))},decodeAesJson:function(e){return JSON.parse(this.decodeAes(e))}},O={encodeUserInfo:function(e){var t=JSON.stringify(e),n=S.encodeAes(t);return S.encodeBase64(n)},decodeUserInfo:function(e){var t=S.decodeBase64(e),n=S.decodeAes(t);return JSON.parse(n)}},j={getItem:function(e){var t=localStorage.getItem(e);return null!==t?JSON.parse(t):null},setItem:function(e,t){localStorage.setItem(e,JSON.stringify(t))},removeItem:function(e){localStorage.removeItem(e)}};a["default"].prototype.$storage=j;var P=j,E=n("2ef0"),M=n.n(E),L={namespaced:!0,state:function(){return{profile:{},accessToken:""}},mutations:{setProfile:function(e,t){e.profile=t},setAccessToken:function(e,t){e.accessToken=t}},getters:{isLogin:function(e){var t=""!==e.accessToken,n=M.a.isEmpty(e.profile);return t&&!n}},actions:{checkHasUserInto:function(e){var t=e.commit,n=P.getItem("userInfo");if(null!==n){var a=O.decodeUserInfo(n.data),r=a.profile,s=a.accessToken;t("setProfile",r),t("setAccessToken",s)}},login:function(e){return Object(m["a"])(regeneratorRuntime.mark((function t(){var n,a,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.state,a=e.commit,e.dispatch,t.next=3,b.login();case 3:if(r=t.sent,!r.status){t.next=11;break}return t.next=7,C.saveUser(r.profile);case 7:a("setProfile",r.profile),a("setAccessToken",r.accessToken),s=O.encodeUserInfo({profile:n.profile,accessToken:n.accessToken}),P.setItem("userInfo",{data:s});case 11:return t.abrupt("return",{status:r.status,message:r.status?"":r.message});case 12:case"end":return t.stop()}}),t)})))()},logout:function(e){return Object(m["a"])(regeneratorRuntime.mark((function t(){var n,a,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.state,a=e.commit,r=e.dispatch,s=e.rootState,t.next=3,C.removePresence(n.profile.uid);case 3:return t.next=5,b.logout();case 5:if(""===s.channelId){t.next=8;break}return t.next=8,r("removeEvent",null,{root:!0});case 8:a("setProfile",{}),a("setAccessToken",""),P.removeItem("userInfo");case 11:case"end":return t.stop()}}),t)})))()}}},R=function(e){e.dispatch("authStore/checkHasUserInto"),e.subscribe((function(e,t){}))},T=p.database().ref("messages"),U=p.database().ref("privateMsg");a["default"].use(f["a"]);var N=new f["a"].Store({state:{channelId:"",channelLists:[],userLists:[],isPrivate:!1},mutations:{setChannelId:function(e,t){e.channelId=t},setChannelItem:function(e,t){e.channelLists.push(t)},clearChannelLists:function(e){e.channelLists=[]},addUserItem:function(e,t){e.userLists.push(t)},changeUserOnlineStatus:function(e,t){var n=e.userLists.find((function(e){return e.uid===t.userId}));void 0!==n&&(n.isOnline=t.status)},clearUserLists:function(e){e.userLists=[]},setIsPrivate:function(e,t){e.isPrivate=t}},getters:{channelName:function(e){var t=e.channelLists.find((function(t){return t.id===e.channelId})),n=e.userLists.find((function(t){return t.uid===e.channelId}));return void 0!==t?t.name:void 0!==n?n.name:""}},actions:{removeEvent:function(e){var t=e.state,n=e.commit;if(t.isPrivate){var a=t.channelId,r=t.authStore.profile.uid,s=a<r?"".concat(a,"/").concat(r):"".concat(r,"/").concat(a);U.child(s).off("child_added")}else T.child(t.channelId).off("child_added");n("setIsPrivate",!1)}},modules:{authStore:L},plugins:[R]}),A=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"container-fluid"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-md-4 sidebar"},[n("sidebar",{on:{logout:e.logoutHandler,openModal:e.openModal}})],1),n("div",{staticClass:"col-md-8 content"},[n("Message")],1)])]),n("Loading",{directives:[{name:"show",rawName:"v-show",value:e.isLoading,expression:"isLoading"}]}),n("div",{staticClass:"modal fade",attrs:{id:"channelModal"}},[n("div",{staticClass:"modal-dialog modal-dialog-centered",attrs:{role:"document"}},[n("div",{staticClass:"modal-content"},[e._m(0),n("div",{staticClass:"modal-body"},[n("form",[n("div",{staticClass:"form-group"},[n("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.new_channel,expression:"new_channel",modifiers:{trim:!0}}],staticClass:"form-control",attrs:{type:"text",id:"new_channel",name:"new_channel",placeholder:"Channel name",autocomplete:"off"},domProps:{value:e.new_channel},on:{input:function(t){t.target.composing||(e.new_channel=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),n("ul",{staticClass:"list-group"},[n("li",{directives:[{name:"show",rawName:"v-show",value:e.hasAddError,expression:"hasAddError"}],staticClass:"list-group-item text-danger"},[e._v(" "+e._s(e.addError)+" ")])])])]),n("div",{staticClass:"modal-footer"},[n("button",{staticClass:"btn btn-secondary",attrs:{"data-dismiss":"modal"}},[e._v("Cancle")]),n("button",{staticClass:"btn btn-primary",on:{click:e.addChannel}},[e._v("Add Channel")])])])])])],1)},q=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"modal-header"},[n("h5",{staticClass:"modal-title text-dark"},[e._v("Channel name")]),n("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[n("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])])}],F=n("5530"),H=(n("5319"),n("ac1f"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h2",{staticClass:"text-light"},[e._v("SLACK")]),n("hr",{staticStyle:{border:"1px solid #333"}}),n("span",[n("img",{staticClass:"rounded-circle mr-2",attrs:{src:e.userProfile.picture,height:"30"}}),n("span",{staticClass:"text-light"},[e._v(e._s(e.userProfile.name))])]),n("hr",{staticStyle:{border:"1px solid #333"}}),n("button",{staticClass:"btn btn-outline-light",on:{click:e.logout}},[e._v("登出")]),n("hr",{staticStyle:{border:"1px solid #333"}}),n("button",{staticClass:"btn btn-outline-primary",on:{click:e.openModal}},[e._v("Add Channel")]),n("div",{staticClass:"mt-4"},e._l(e.channelLists,(function(e){return n("ChannelItem",{key:e.id,attrs:{id:e.id,channelName:e.name}})})),1),n("hr",{staticStyle:{border:"1px solid #333"}}),n("div",[n("div",{staticClass:"text-light"},[n("h4",[e._v("Users")]),n("div",{staticClass:"mt-4"},e._l(e.userLists,(function(e){return n("Users",{key:e.uid,attrs:{userId:e.uid,userName:e.name,avatar:e.avatar,isOnline:e.isOnline}})})),1)])])])}),J=[],B=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{staticClass:"list-group-item list-group-item-action channel-item",class:{active:e.isActive},on:{click:e.changeChannel}},[e._v(" "+e._s(e.channelName)+" ")])},D=[],G={props:{id:{type:String,required:!0},channelName:{type:String,required:!0}},computed:{channelId:function(){return this.$store.state.channelId},isActive:function(){return this.id===this.channelId}},methods:{changeChannel:function(){this.$store.commit("setChannelId",this.id),this.$store.commit("setIsPrivate",!1)}}},W=G,z=Object(c["a"])(W,B,D,!1,null,null,null),K=z.exports,Z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{staticClass:"list-group-item list-group-item-action",class:{active:e.isActive},on:{click:e.changeUser}},[n("span"),n("span",[n("img",{staticClass:"img rounded-circle",attrs:{src:e.avatar,height:"20"}}),n("span",[n("a",{class:e.statusClass,attrs:{href:"javascript:;"}},[e._v(e._s(e.userName))]),n("span",{staticClass:"float-right"})])])])},V=[],X={props:{userId:{type:String,required:!0},userName:{type:String,required:!0},avatar:{type:String,required:!0},isOnline:{type:Boolean,required:!0}},computed:{statusClass:function(){return this.isOnline?"text-primary":"text-danger"},isActive:function(){return this.$store.state.channelId===this.userId}},methods:{changeUser:function(){this.$store.commit("setChannelId",this.userId),this.$store.commit("setIsPrivate",!0)}}},Y=X,Q=(n("c649"),Object(c["a"])(Y,Z,V,!1,null,"2facd434",null)),ee=Q.exports,te=p.database().ref("users"),ne=p.database().ref(".info/connected"),ae=p.database().ref("presence"),re={components:{ChannelItem:K,Users:ee},computed:Object(F["a"])(Object(F["a"])({},Object(f["c"])("authStore",{userProfile:"profile"})),Object(f["c"])(["channelLists","userLists"])),methods:Object(F["a"])(Object(F["a"])({},Object(f["b"])(["changeUserOnlineStatus"])),{},{logout:function(){this.$emit("logout")},openModal:function(){this.$emit("openModal")},userCallback:function(e){this.userProfile.uid!==e.key&&this.$store.commit("addUserItem",Object(F["a"])(Object(F["a"])({},e.val()),{},{uid:e.key,isOnline:!1}))},detectOnline:function(e){var t=e.val();if(t){var n=ae.child(this.userProfile.uid);n.set(!0),n.onDisconnect().remove()}},addUserEvent:function(){te.on("child_added",this.userCallback),ne.on("value",this.detectOnline),ae.on("child_added",this.addPresence),ae.on("child_removed",this.removePresence)},addPresence:function(e){var t=e.key;t!==this.userProfile.uid&&this.changeUserOnlineStatus({userId:t,status:!0})},removePresence:function(e){e.key!==this.userProfile.uid&&this.changeUserOnlineStatus({userId:e.key,status:!1})}}),mounted:function(){this.addUserEvent()},beforeDestroy:function(){te.off("child_added",this.userCallback),ne.off("value",this.detectOnline),ae.off("child_added",this.addPresence),ae.off("child_removed",this.removePresence),this.$store.commit("clearUserLists")}},se=re,ie=Object(c["a"])(se,H,J,!1,null,null,null),oe=ie.exports,ce=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"message-wrap"},[n("h2",[e._v(e._s(e.channelName))]),n("div",{staticClass:"mt-3 mb-5"},e._l(e.msgLists,(function(e){return n("SingleMessage",{key:e.msgId,attrs:{msgId:e.msgId,content:e.content,contentType:e.contentType,userName:e.user.name,userId:e.user.id,avatar:e.user.avatar,timestamp:e.timestamp}})})),1),n("MessageForm",{attrs:{percent:e.percent,uploadState:e.uploadState},on:{sendMsg:e.sendMsg,openModal:e.openUploadModal}}),n("FileModal",{ref:"fileModal",on:{uploadFile:e.uploadFileHandler}})],1)},le=[],ue=n("ec26"),de=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"media"},[n("div",{staticClass:"media-body"},[n("img",{staticClass:"align-self-start mr-3",attrs:{src:e.avatar,height:"200"}}),n("h6",{staticClass:"mt-0"},[n("a",{attrs:{href:"javascript:;"}},[e._v(e._s(e.userName)+" - "+e._s(e.releaseTime))])]),"text"===e.contentType?n("p",{class:{self_message:e.isSelf}},[e._v(e._s(e.content))]):n("img",{attrs:{src:e.content,alt:"",width:"150",height:"150"}})])])])},fe=[],me=(n("a9e3"),{props:{msgId:{type:String,required:!0},content:{type:String,required:!0},contentType:{type:String,required:!0},userName:{type:String,required:!0},userId:{type:String,required:!0},avatar:{type:String,required:!0},timestamp:{type:Number,required:!0}},computed:{releaseTime:function(){var e=new Date(this.timestamp),t=e.getFullYear(),n=e.getMonth()+1,a=e.getDate(),r=e.getHours(),s=e.getMinutes();return"".concat(t,"/").concat(n,"/").concat(a," ").concat(r,":").concat(s)},isSelf:function(){return this.$store.state.authStore.profile.uid===this.userId}}}),he=me,pe=(n("21a6"),Object(c["a"])(he,de,fe,!1,null,"7ae89ae0",null)),ge=pe.exports,ve=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"messageform"},[n("div",{directives:[{name:"show",rawName:"v-show",value:""!==e.uploadState,expression:"uploadState !== ''"}],staticClass:"progress"},[n("div",{staticClass:"progress-bar progress-bar-striped progress-bar-animated",style:{width:e.progressWidth}},[e._v(" "+e._s(e.uploadState)+" ")])]),n("div",[n("div",{staticClass:"input-group mb-3"},[n("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.message,expression:"message",modifiers:{trim:!0}}],staticClass:"form-control mt-3",attrs:{id:"message",placeholder:"Write something",name:"message",autocomplete:"off"},domProps:{value:e.message},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendHandler(t)},input:function(t){t.target.composing||(e.message=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),n("div",{staticClass:"input-group-append"},[n("button",{staticClass:"btn btn-primary mt-3",on:{click:e.sendHandler}},[e._v("Send")])]),n("div",{staticClass:"input-group-append"},[n("button",{staticClass:"btn btn-warning mt-3",on:{click:e.uploadHandler}},[e._v("Upload")])])])])])])},be=[],Ce={props:{percent:{type:Number,required:!0},uploadState:{type:String,required:!0}},data:function(){return{message:""}},computed:{channelId:function(){return this.$store.state.channelId},progressWidth:function(){return"".concat(this.percent,"%")}},methods:{sendHandler:function(){""!==this.message&&""!==this.channelId&&(this.$emit("sendMsg",{msg:this.message,type:"text"}),this.message="")},uploadHandler:function(){""!==this.channelId&&this.$emit("openModal")}}},_e=Ce,we=(n("a43f"),Object(c["a"])(_e,ve,be,!1,null,"5fbdbf41",null)),ye=we.exports,xe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"modal fade",attrs:{id:"fileModal"}},[n("div",{staticClass:"modal-dialog modal-dialog-centered",attrs:{role:"document"}},[n("div",{staticClass:"modal-content"},[e._m(0),n("div",{staticClass:"modal-body"},[n("form",{staticClass:"form"},[n("div",{staticClass:"form-group"},[n("input",{ref:"file",staticClass:"form-control",attrs:{type:"file",id:"file",name:"file"},on:{change:e.fileChange}})])])]),n("div",{staticClass:"modal-footer"},[n("button",{staticClass:"btn btn-secondary",attrs:{"data-dismiss":"modal"}},[e._v("Cancle")]),n("button",{staticClass:"btn btn-primary",on:{click:e.uploadHandler}},[e._v("Send file")])])])])])},ke=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"modal-header"},[n("h5",{staticClass:"modal-title text-dark"},[e._v("Upload file (jpeg, png, imb max)")]),n("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[n("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])])])}],Ie=(n("caad"),n("1276"),n("cc1d")),Se={data:function(){return{file:null}},methods:{fileChange:function(e){var t=e.target.files[0],n=["image/jpeg","image/jpg","image/png"],a=n.includes(t.type);if(!a)return alert("只能上傳圖片檔案"),void this.resetFile();this.file=t},uploadHandler:function(){if(null===this.file)return alert("請選擇圖片");var e=this.file.type.split("/")[1],t={contentType:Ie.lookup(this.file.name)};this.$emit("uploadFile",{file:this.file,extension:e,metadata:t})},resetFile:function(){this.file=null,this.$refs.file.type="text",this.$refs.file.type="file"}}},Oe=Se,je=Object(c["a"])(Oe,xe,ke,!1,null,null,null),Pe=je.exports,$e=p.database().ref("messages"),Ee=p.database().ref("privateMsg"),Me=p.storage().ref(),Le={components:{SingleMessage:ge,MessageForm:ye,FileModal:Pe},data:function(){return{msgLists:[],percent:0,uploadState:""}},computed:Object(F["a"])(Object(F["a"])(Object(F["a"])({},Object(f["c"])(["channelId","isPrivate"])),Object(f["c"])("authStore",{userProfile:"profile"})),{},{channelName:function(){return this.$store.getters.channelName},privateChildRef:function(){var e=this.channelId,t=this.userProfile.uid;return this.channelId<this.userProfile.uid?"".concat(e,"/").concat(t):"".concat(t,"/").concat(e)}}),methods:{sendMsg:function(e){var t=this;return Object(m["a"])(regeneratorRuntime.mark((function n(){var a,r,s,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=e.msg,r=e.type,s={content:a,contentType:r,timestamp:p.database.ServerValue.TIMESTAMP,user:{name:t.userProfile.name,avatar:t.userProfile.picture,id:t.userProfile.uid}},i=t.isPrivate?"addPrivateMsg":"addMessage",n.next=5,C[i]({channelId:t.isPrivate?t.privateChildRef:t.channelId,msgInfo:s});case 5:case"end":return n.stop()}}),n)})))()},msgCallback:function(e){var t=this;return Object(m["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.msgLists.push(Object(F["a"])({msgId:e.key},e.val())),n.next=3,t.$nextTick();case 3:window.scrollTo(0,document.documentElement.scrollHeight);case 4:case"end":return n.stop()}}),n)})))()},addMsgEvent:function(){""!==this.channelId&&(this.isPrivate?Ee.child(this.privateChildRef).on("child_added",this.msgCallback):$e.child(this.channelId).on("child_added",this.msgCallback))},openUploadModal:function(){$("#fileModal").modal("show")},getStoragePath:function(){var e=this.channelId;return this.isPrivate?"chat/private/".concat(e):"chat/public/".concat(e)},uploadFileHandler:function(e){var t=this,n=e.file,a=e.extension,r=e.metadata,s="".concat(this.getStoragePath(),"/").concat(Object(ue["a"])(),".").concat(a),i=Me.child(s).put(n,r);i.on("state_change",(function(e){t.percent=e.bytesTransferred/e.totalBytes*100,t.uploadState="uploading..."}),(function(){t.uploadState="upload error"}),Object(m["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i.snapshot.ref.getDownloadURL();case 2:return n=e.sent,e.next=5,t.sendMsg({msg:n,type:"image"});case 5:t.uploadState="upload completed",t.$refs.fileModal.resetFile(),t.percent=0,t.uploadState="",$("#fileModal").modal("hide");case 10:case"end":return e.stop()}}),e)}))))}},mounted:function(){this.addMsgEvent()},watch:{channelId:function(e,t){""!==e&&""!==t&&$e.child(t).off("child_added",this.msgCallback)},privateChildRef:function(e,t){Ee.child(t).off("child_added",this.msgCallback),this.msgLists=[],this.addMsgEvent()}}},Re=Le,Te=(n("d75a"),Object(c["a"])(Re,ce,le,!1,null,"23c0d966",null)),Ue=Te.exports,Ne=p.database().ref("channels"),Ae={name:"chat",components:{Sidebar:oe,Message:Ue},data:function(){return{isLoading:!1,new_channel:"",addError:""}},computed:Object(F["a"])({hasAddError:function(){return""!==this.addError}},Object(f["c"])(["channelLists","channelId"])),methods:{logoutHandler:function(){var e=this;return Object(m["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isLoading=!0,t.next=3,e.$store.dispatch("authStore/logout");case 3:e.$router.replace("/login"),e.isLoading=!1;case 5:case"end":return t.stop()}}),t)})))()},openModal:function(){$("#channelModal").modal("show")},checkSameChannel:function(){var e=this,t=this.channelLists.find((function(t){return t.name.toLowerCase()===e.new_channel.toLowerCase()}));return void 0!==t},addChannel:function(){var e=this;return Object(m["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.addError="",""!==e.new_channel){t.next=3;break}return t.abrupt("return",e.addError="請輸入頻道名稱");case 3:if(n=e.checkSameChannel(),!n){t.next=6;break}return t.abrupt("return",e.addError="已有相同的頻道");case 6:return e.isLoading=!0,t.next=9,C.addChannel(e.new_channel);case 9:a=t.sent,a.status&&(e.new_channel="",$("#channelModal").modal("hide")),e.isLoading=!1;case 12:case"end":return t.stop()}}),t)})))()},channelCallback:function(e){this.$store.commit("setChannelItem",e.val())},addChannelEvent:function(){var e=this;return Object(m["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:Ne.on("child_added",e.channelCallback);case 1:case"end":return t.stop()}}),t)})))()}},mounted:function(){this.addChannelEvent()},beforeDestroy:function(){this.$store.commit("setChannelId",""),this.$store.commit("clearChannelLists"),Ne.off("child_added",this.channelCallback)}},qe=Ae,Fe=(n("11f4"),Object(c["a"])(qe,A,q,!1,null,"2738561c",null)),He=Fe.exports,Je=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._m(0),n("div",{staticClass:"col-md-6 offset-md-3"},[e._m(1),n("form",[e._m(2),e._m(3),n("button",{staticClass:"btn btn-lg btn-primary form-control",attrs:{type:"submit"}},[e._v(" Login ")]),n("button",{staticClass:"btn btn-primary form-control",attrs:{disabled:""}},[e._v(" Please wait... ")]),n("big",{staticClass:"form-text"},[e._v("Not registered yet? "),n("router-link",{attrs:{to:"register"}},[e._v("Register")]),n("span",{staticClass:"float-right text-success"},[n("span",[e._v("Forgot password")]),n("span",[n("i",{staticClass:"fa fa-close text-danger"})])])],1),n("br"),n("div",{directives:[{name:"show",rawName:"v-show",value:e.hasError,expression:"hasError"}],staticClass:"alert alert-danger"},[n("div",[e._v(e._s(e.loginErrorText))])])],1),e._m(4),n("div",{staticClass:"text-center mt-4"},[n("button",{staticClass:"btn btn-danger btn-lg btn-block",on:{click:e.loginWithGoogle}},[e._v(" Login with Google ")])])]),n("Loading",{directives:[{name:"show",rawName:"v-show",value:e.isLoading,expression:"isLoading"}]})],1)},Be=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"jumbotron bg-primary text-white text-center"},[n("h2",{staticClass:"lead display-3"},[e._v("#SLACK#")]),n("hr"),n("p",[e._v("Realtime communication at it's best!")]),n("hr")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("h2",{staticClass:"text-center text-primary mb-5 display-4"},[n("i",{staticClass:"fa fa-user"}),e._v(" Login ")])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"form-group"},[n("input",{staticClass:"form-control",attrs:{type:"email",name:"email",placeholder:"Email",required:""}})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"form-group"},[n("input",{staticClass:"form-control",attrs:{type:"password",password:"password",placeholder:"Password",required:""}})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("form",[n("div",{staticClass:"input-group"},[n("input",{staticClass:"form-control",attrs:{type:"email",name:"forgot_password",placeholder:"Email to send password reset link"}}),n("button",{staticClass:"btn btn-primary"},[e._v(" Submit ")])]),n("br"),n("div",{staticClass:"alert alert-danger"},[n("div")])])}],De={name:"login",data:function(){return{isLoading:!1,loginErrorText:""}},computed:{hasError:function(){return""!==this.loginErrorText}},methods:{loginWithGoogle:function(){var e=this;return Object(m["a"])(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loginErrorText="",e.isLoading=!0,t.next=4,e.$store.dispatch("authStore/login");case 4:n=t.sent,a=n.status,r=n.message,e.loginErrorText=r,a&&e.$router.replace("/chat"),e.isLoading=!1;case 10:case"end":return t.stop()}}),t)})))()}}},Ge=De,We=(n("66c0"),Object(c["a"])(Ge,Je,Be,!1,null,null,null)),ze=We.exports;a["default"].use(d["a"]);var Ke=[{path:"/chat",name:"chat",component:He,meta:{auth:!0}},{path:"/login",name:"login",component:ze,beforeEnter:function(e,t,n){return N.getters["authStore/isLogin"]?n("/chat"):n()}},{path:"*",redirect:"/login"}],Ze=new d["a"]({mode:"hash",routes:Ke});Ze.beforeEach((function(e,t,n){return e.matched.some((function(e){return!0===e.meta.auth}))?N.getters["authStore/isLogin"]?n():n("/login"):n()}));var Ve=Ze,Xe=n("a6f4"),Ye=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},Qe=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"loading"}},[n("div",{staticClass:"dots"},[n("div"),n("div"),n("div")])])}],et={},tt=et,nt=(n("5fa0"),Object(c["a"])(tt,Ye,Qe,!1,null,null,null)),at=nt.exports;a["default"].component("Loading",at),a["default"].config.productionTip=!1,a["default"].use(Xe["a"]),new a["default"]({router:Ve,store:N,render:function(e){return e(u)}}).$mount("#app")},"5fa0":function(e,t,n){"use strict";n("6675")},6:function(e,t){},6675:function(e,t,n){},"66c0":function(e,t,n){"use strict";n("2154")},7:function(e,t){},"7b9f":function(e,t,n){},8:function(e,t){},9:function(e,t){},a43f:function(e,t,n){"use strict";n("00ac")},c649:function(e,t,n){"use strict";n("ff6f")},d75a:function(e,t,n){"use strict";n("2646")},f127:function(e,t,n){},ff6f:function(e,t,n){}});
//# sourceMappingURL=app.js.map